function renderRepaymentSchedule(goalAmount) {
  const tbody = document.querySelector("#repaymentScheduleTable tbody");
  tbody.innerHTML = "";

  const allRecords = loadRecords().map(rec => ({
    date: new Date(rec.date),
    amount: rec.amount
  }));

  let start = new Date(2025, 8); // 2025年9月（0-indexed）
  let remaining = goalAmount;
  let cumulativePlanned = 0;
  let cumulativeActual = 0;

  for (let i = 0; i < 60 && remaining > 0; i++) {
    const year = start.getFullYear();
    const month = start.getMonth() + 1;

    // 1. 予定返済額の計算
    let planned = 40000;
    if (year === 2025 && month === 9) {
      planned += 200000; // 頭金
    }
    if (month === 6 || month === 12) {
      planned += 300000; // ボーナス返済
    }

    // 上限調整
    const actualPlanned = Math.min(planned, remaining);
    cumulativePlanned += actualPlanned;
    remaining -= actualPlanned;

    // その月の入金合計
    const monthlyActual = allRecords
      .filter(r => r.date.getFullYear() === year && r.date.getMonth() === start.getMonth())
      .reduce((sum, r) => sum + r.amount, 0);

    // それまでの入金があるかどうかを確認
    const hasAnyActual = allRecords.some(r => {
      return (
        r.date.getFullYear() < year ||
        (r.date.getFullYear() === year && r.date.getMonth() <= start.getMonth())
      );
    });

    let rowHtml = `
      <td>${year}年${String(month).padStart(2, '0')}月</td>
      <td>${actualPlanned.toLocaleString()}</td>
      <td>${cumulativePlanned.toLocaleString()}</td>
    `;

    if (hasAnyActual) {
      cumulativeActual += monthlyActual;
      const remainingAfterActual = goalAmount - cumulativePlanned;

      rowHtml += `
        <td style="font-weight: bold; color: darkblue;">${monthlyActual.toLocaleString()}</td>
        <td style="font-weight: bold; color: darkblue;">${cumulativeActual.toLocaleString()}</td>
        <td>${Math.max(remainingAfterActual, 0).toLocaleString()}</td>
      `;
    } else {
      // 空白にする
      rowHtml += `
        <td></td>
        <td></td>
        <td></td>
      `;
    }

    const row = document.createElement("tr");
    row.innerHTML = rowHtml;
    tbody.appendChild(row);

    start.setMonth(start.getMonth() + 1);
  }
}
